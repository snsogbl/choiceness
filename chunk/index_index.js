(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"12":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.default=void 0;var o=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),a=n(5),i=_interopRequireDefault(a),r=_interopRequireDefault(n(6)),u=n(7),s=_interopRequireWildcard(n(18)),l=_interopRequireWildcard(n(17)),c=n(19);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}n(20);var f=function(e){function Index(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Index);var e=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Index.__proto__||Object.getPrototypeOf(Index)).apply(this,arguments));return e.config={"navigationBarTitleText":"首页"},e.state={"isShowAuthorize":!1},e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Index,a.Component),o(Index,[{"key":"componentWillMount","value":function componentWillMount(){}},{"key":"componentDidMount","value":function componentDidMount(){i.default.getEnv()===i.default.ENV_TYPE.WEB?i.default.redirectTo({"url":"/pages/homePage/homePage"}):this.checkLogin()}},{"key":"loginFinish","value":function loginFinish(){i.default.getEnv()===i.default.ENV_TYPE.WEAPP&&i.default.reLaunch({"url":"/pages/homePage/homePage"})}},{"key":"componentWillUnmount","value":function componentWillUnmount(){}},{"key":"componentDidShow","value":function componentDidShow(){}},{"key":"componentDidHide","value":function componentDidHide(){}},{"key":"checkLogin","value":function checkLogin(){var e=l.getStorageSync(l.k_MEMBBER),t=l.getStorageSync(l.k_TOKEN_ID),n=l.getStorageSync(l.k_STORE_USER_INFO);e&&t&&n?(l.setData(l.k_MEMBBER,e),l.setData(l.k_TOKEN_ID,t),l.setData(l.k_STORE_USER_INFO,n),this.loginFinish()):this.wxlogin()}},{"key":"wxlogin","value":function wxlogin(){i.default.showLoading&&i.default.showLoading({"title":"登录微信…","mask":!0});var e=this;i.default.login({"success":function success(t){e.wxCode=t.code,i.default.showLoading&&i.default.showLoading({"title":"同步微信信息…","mask":!0}),i.default.getUserInfo({"withCredentials":!0,"success":function success(t){var n={"nickName":t.userInfo.nickName,"avatarUrl":t.userInfo.avatarUrl,"code":e.wxCode};l.setStorageSync(l.k_STORE_USER_INFO,n),e.wxEncryptedData=t.encryptedData,e.wxIv=t.iv,e.requestLogin()},"fail":function fail(t){i.default.hideLoading&&i.default.hideLoading(),e.setState({"isShowAuthorize":!0})}})},"fail":function fail(e){i.default.hideLoading&&i.default.hideLoading(),i.default.showToast({"title":"网络当前不可用,请稍后再试","icon":"none"})}})}},{"key":"requestLogin","value":function requestLogin(){var e=i.default.getSystemInfoSync(),t={"url":c.wx_user_login,"data":{"code":this.wxCode,"encryptedData":this.wxEncryptedData,"iv":this.wxIv,"deviceInfo":JSON.stringify(e)},"success":function(e){var t=e.member,n=e.sessionId;e.thirdPartyError;l.setData(l.k_TOKEN_ID,n),l.setStorageSync(l.k_TOKEN_ID,n),""!=t&&(l.setData(l.k_MEMBBER,t),l.setData(l.k_OPEN_ID,e.openId),l.setStorageSync(l.k_MEMBBER,t),l.setStorageSync(l.k_OPEN_ID,e.openId),this.loginFinish())}.bind(this),"fail":function fail(e){}};s.wxRequest(t)}},{"key":"requestData","value":function requestData(){var e={"url":"https://ssl.yunhou.com/beacons/shop/list","method":"GET","data":{},"success":function success(e){console.log("请求成功"),console.log(e)},"fail":function fail(e){console.log("请求失败"),console.log(e)}};s.wxRequest(e)}},{"key":"getUserInfo","value":function getUserInfo(e){"getUserInfo:ok"==e.detail.errMsg?this.wxlogin():i.default.switchTab({"url":"/pages/homePage/homePage"})}},{"key":"toGuest","value":function toGuest(){i.default.switchTab({"url":"/pages/homePage/homePage"})}},{"key":"render","value":function render(){var e=r.default.createElement(u.View,{"className":"container"},r.default.createElement(u.View,{"className":"gradient-bg"},r.default.createElement(u.Button,{"className":"weixinbutton","openType":"getUserInfo","onGetUserInfo":this.getUserInfo},"微信授权"),r.default.createElement(u.View,{"className":"phonebutton","onClick":this.toGuest},"游客进入")));return r.default.createElement(u.View,null,this.state.isShowAuthorize&&e)}}]),Index}();t.default=f},"17":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.globalData=t.setStorageSync=t.getStorageSync=t.setData=t.getData=t.k_CONFIG_DATA=t.k_SCENE=t.k_OPEN_ID=t.k_MEMBBER=t.k_TOKEN_ID=t.k_STORE_USER_INFO=t.k_USER=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=_interopRequireDefault(n(5));_interopRequireDefault(n(6));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}t.k_USER="user",t.k_STORE_USER_INFO="storeUserInfo",t.k_TOKEN_ID="tokenId",t.k_MEMBBER="member",t.k_OPEN_ID="openId",t.k_SCENE="scene",t.k_CONFIG_DATA="configData";var i={"scene":"","tokenId":"","openId":"","user":{},"storeUserInfo":"","member":{},"configData":""};t.getData=function getData(e){return i[e]},t.setData=function setData(e,t){(void 0===t?"undefined":o(t))==Object?i[e]=Object.assign({},t):i[e]=t},t.getStorageSync=function getStorageSync(e){return a.default.getStorageSync(e)},t.setStorageSync=function setStorageSync(e,t){a.default.setStorageSync(e,t)},t.globalData=i},"18":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.getCookie=t.setCookie=t.navigateToWeb=t.delParam=t.updateParam=t.formatWebUrl=t.wxRequest=void 0;var o=_interopRequireDefault(n(5)),a=(_interopRequireDefault(n(6)),function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}t.wxRequest=function wxRequest(e){console.log("请求链接： "+e.url),console.log("发送数据："+JSON.stringify(e.data)),e.tipType||(e.tipType=1);var t,n="bg"+Date.parse(new Date)+Math.random().toString(36).substr(2,15);t=-1!=e.url.indexOf("?")?e.url+"&_trc="+n:e.url+"?_trc="+n;var i=a.getData("configData");i&&i.businessDistrictId&&i.businessDistrictId,o.default.request({"url":t,"method":e.method||"POST","header":{"content-type":"application/x-www-form-urlencoded","tokenId":o.default.getStorageSync("tokenId"),"trackId":"","businessDistrictId":1},"data":e.data}).then(function(t){console.log(t),console.log("endTime:"+Date.parse(new Date)),200==t.statusCode?0==t.data.error?e.success(t.data.data):-100==t.data.error?o.default.showModal({"title":"提示","content":"请先登录"}):(o.default.hideLoading&&o.default.hideLoading(),e.fail&&e.fail(t.data),t.data.msg&&1==e.tipType&&o.default.showToast({"title":""+t.data.msg,"icon":"none"})):(o.default.hideLoading&&o.default.hideLoading(),e.fail&&e.fail(t),setTimeout(function(){o.default.showToast({"title":"网络当前不可用,请稍后再试","icon":"none"})},400))})},t.formatWebUrl=function formatWebUrl(e){var t=a.getData(a.k_CONFIG_DATA),n="",o=[];t&&(this.GetQueryString(e,"channel")||o.push("channel="+t.shopInfo.channel),this.GetQueryString(e,"businessDistrictId")||o.push("businessDistrictId="+t.businessDistrictId)),n=-1!=e.indexOf("?")?e+"&"+o.join("&"):e+"?"+o.join("&");var i=a.getData(a.k_TOKEN_ID);n=this.updateParam(n,"tokenId",i);var r=a.getData(a.k_OPEN_ID);return n=this.updateParam(n,"openId",r),n=this.updateParam(n,"wxScene",a.getData(a.k_SCENE)),n=this.updateParam(n,"appSource","bbgPlus"),console.log("web url:"+n),n},t.updateParam=function updateParam(e,t,n){var o=this.delParam(e,t),a=[];return a.push(t+"="+n),o=-1!=o.indexOf("?")?o+"&"+a.join("&"):o+"?"+a.join("&")},t.delParam=function delParam(e,t){if(-1!=e.indexOf("?")){var n=e.split("?")[0],o=e.split("?")[1];if(""!=o){for(var a=o.split("&"),i=[],r=0;r<a.length;r++)a[r].split("=")[0]!=t&&i.push(a[r]);var u="";return i.length>0&&(u="?"+i.join("&")),n+u}return e}return e},t.navigateToWeb=function navigateToWeb(e){console.log("h5");var t=this.formatWebUrl(e);window.location.href=t},t.setCookie=function setCookie(e,t){var n=new Date;n.setTime(n.getTime()+2592e6),document.cookie=e+"="+escape(t)+";expires="+n.toGMTString()},t.getCookie=function getCookie(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):null}},"19":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});t.apiUrl="https://ssl.yunhou.com/",t.sms_login="https://ssl.yunhou.com/user/sms_login",t.get_homepage_config="https://ssl.yunhou.com/beacons/appdata/format",t.weixin_recommend="https://ssl.yunhou.com/act/search/weixin_recommend",t.wx_user_login="https://ssl.yunhou.com/beacons/user/wx_user_login"},"20":function(e,t,n){}}]);